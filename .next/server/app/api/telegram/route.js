"use strict";(()=>{var e={};e.id=490,e.ids=[490],e.modules={7225:e=>{e.exports=require("lodash/defaults")},7047:e=>{e.exports=require("lodash/difference")},8579:e=>{e.exports=require("lodash/flatten")},5452:e=>{e.exports=require("lodash/isPlainObject")},215:e=>{e.exports=require("lodash/union")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:e=>{e.exports=require("assert")},4300:e=>{e.exports=require("buffer")},2057:e=>{e.exports=require("constants")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3292:e=>{e.exports=require("fs/promises")},1415:e=>{e.exports=require("node:events")},7561:e=>{e.exports=require("node:fs")},3977:e=>{e.exports=require("node:fs/promises")},9411:e=>{e.exports=require("node:path")},4492:e=>{e.exports=require("node:stream")},6915:e=>{e.exports=require("node:string_decoder")},1041:e=>{e.exports=require("node:url")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},3780:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>q,originalPathname:()=>P,patchFetch:()=>v,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>x,staticGenerationBailout:()=>w});var o={};t.r(o),t.d(o,{POST:()=>m});var s=t(5419),a=t(9108),i=t(9678),n=t(8070),l=t(3292),u=t(1017),p=t(7147),d=t(9860),c=t.n(d);async function m(e){try{let{sku:r,chatId:t}=await e.json();if(!r||!t)return n.Z.json({error:"SKU and chatId are required"},{status:400});let o=t.startsWith("-")?parseInt(t):t;console.log("Using chatId:",{original:t,numeric:o});let s=(0,u.join)(process.cwd(),"temp",r),a=await (0,l.readdir)(s);if(0===a.length)return n.Z.json({error:"No processed files found for this SKU"},{status:404});let i=`${r}.zip`,d=(0,u.join)(s,i);try{let e=(0,p.createWriteStream)(d),r=c()("zip",{zlib:{level:9}});for(let t of(e.on("close",()=>{console.log(`ZIP archive created: ${d}`)}),r.on("error",e=>{throw e}),r.pipe(e),a)){let e=(0,u.join)(s,t),o=await (0,l.readFile)(e);r.append(o,{name:t})}await r.finalize()}catch(e){return console.error("Error creating ZIP archive:",e),n.Z.json({error:"Failed to create ZIP archive"},{status:500})}let m=await (0,l.readFile)(d),g=new File([new Uint8Array(m)],i,{type:"application/zip"}),h=new FormData;h.append("chat_id",String(o)),h.append("document",g),h.append("caption",`Обработанные фотографии для артикула: ${r}
Всего файлов: ${a.length}`),console.log("Sending to Telegram with FormData:",{chatId:t,fileName:i,fileSize:m.byteLength});let x=await fetch("https://api.telegram.org/bot1405822759:AAFSEYxyfUQw_6m2P6lTDYgjvECrPxe0uG8/sendDocument",{method:"POST",body:h,headers:{}});if(!x.ok){let e=await x.text();return console.error("Telegram API error:",e),n.Z.json({error:"Failed to send file to Telegram"},{status:500})}let f=await x.json();return console.log("File sent to Telegram successfully:",f),n.Z.json({success:!0,message:"File sent to Telegram successfully",telegramMessageId:f.result.message_id})}catch(e){return console.error("Telegram API error:",e),n.Z.json({error:"Internal server error"},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/telegram/route",pathname:"/api/telegram",filename:"route",bundlePath:"app/api/telegram/route"},resolvedPagePath:"/Users/mak/Desktop/PhotoSku/src/app/api/telegram/route.ts",nextConfigOutput:"export",userland:o}),{requestAsyncStorage:h,staticGenerationAsyncStorage:x,serverHooks:f,headerHooks:q,staticGenerationBailout:w}=g,P="/api/telegram/route";function v(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:x})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[638,206,860],()=>t(3780));module.exports=o})();