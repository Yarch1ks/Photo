"use strict";(()=>{var e={};e.id=998,e.ids=[998],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},8820:(e,o,r)=>{r.r(o),r.d(o,{headerHooks:()=>y,originalPathname:()=>h,patchFetch:()=>A,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>v});var t={};r.r(t),r.d(t,{POST:()=>d,dynamic:()=>u});var s=r(5419),i=r(9108),a=r(9678),n=r(8070),l=r(3292),c=r(1017);let u="force-dynamic";async function d(e){try{console.log("=== UPLOAD API START ===");let o=await e.formData(),r=o.get("sku"),t=o.getAll("files");if(console.log("FormData entries:",Array.from(o.entries()).map(([e,o])=>[e,o&&"object"==typeof o&&"name"in o?o.name:o])),!r)return console.error("SKU is required"),n.Z.json({error:"SKU is required"},{status:400});if(!t||0===t.length)return console.error("No files provided"),n.Z.json({error:"No files provided"},{status:400});let s=[];for(let e of t)e&&"object"==typeof e&&"name"in e&&"size"in e&&"type"in e&&"function"==typeof e.arrayBuffer?s.push(e):console.warn("Invalid file detected:",e);if(0===s.length)return console.error("No valid files provided"),n.Z.json({error:"No valid files provided"},{status:400});console.log(`Processing ${s.length} valid files for SKU: ${r}`),console.log("Environment variables for debugging:"),console.log("NODE_ENV:","production"),console.log("RAILWAY_SERVICE_NAME:",process.env.RAILWAY_SERVICE_NAME),console.log("RAILWAY_ENVIRONMENT:",process.env.RAILWAY_ENVIRONMENT);let i=(0,c.join)("/tmp/uploads",r);console.log(`Upload directory: ${i}, Production: true`);try{try{await (0,l.access)(i),console.log(`Directory already exists: ${i}`);let e=(0,c.join)(i,".test-write");await (0,l.writeFile)(e,"test"),await (0,l.unlink)(e),console.log(`Directory is writable: ${i}`)}catch{console.log(`Creating directory: ${i}`),await (0,l.mkdir)(i,{recursive:!0,mode:493}),console.log(`Directory created: ${i}`);let e=(0,c.join)(i,".test-write");await (0,l.writeFile)(e,"test"),await (0,l.unlink)(e),console.log(`New directory is writable: ${i}`)}}catch(e){return console.error("❌ CRITICAL: Error accessing/creating directory:",e),n.Z.json({error:"Storage directory inaccessible",details:e instanceof Error?e.message:"Unknown error",uploadDir:i,isProduction:!0},{status:500})}let a=[];for(let e=0;e<s.length;e++){let o=s[e];console.log(`Processing file ${e+1}/${s.length}: ${o.name}`);let t=o.name.split(".").pop()||"jpg",u=`${r}_${String(e+1).padStart(3,"0")}.${t}`,d=(0,c.join)(i,u);console.log(`File path: ${d}`),console.log(`File size: ${o.size}`),console.log(`File type: ${o.type}`);try{let e=await o.arrayBuffer(),r=Buffer.from(e);await (0,l.writeFile)(d,r),console.log(`✅ File saved successfully: ${d}`)}catch(e){return console.error(`❌ Error saving file ${d}:`,e),n.Z.json({error:`Failed to save file: ${o.name}`},{status:500})}a.push({id:`file_${e+1}`,originalName:o.name,fileName:u,filePath:d,url:`/api/images/${r}/${u}`,type:o.type.startsWith("image/")?"image":"video",size:o.size,sku:r})}return console.log("=== UPLOAD API SUCCESS ==="),console.log("Processed files:",a),n.Z.json({success:!0,files:a,sku:r})}catch(e){return console.error("❌ UPLOAD API ERROR:",e),n.Z.json({error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"/Users/mak/Desktop/PhotoSku/src/app/api/upload/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:m,headerHooks:y,staticGenerationBailout:v}=p,h="/api/upload/route";function A(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:f})}}};var o=require("../../../webpack-runtime.js");o.C(e);var r=e=>o(o.s=e),t=o.X(0,[638,206],()=>r(8820));module.exports=t})();