"use strict";(()=>{var e={};e.id=182,e.ids=[182],e.modules={7225:e=>{e.exports=require("lodash/defaults")},7047:e=>{e.exports=require("lodash/difference")},8579:e=>{e.exports=require("lodash/flatten")},5452:e=>{e.exports=require("lodash/isPlainObject")},215:e=>{e.exports=require("lodash/union")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:e=>{e.exports=require("assert")},4300:e=>{e.exports=require("buffer")},2057:e=>{e.exports=require("constants")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3292:e=>{e.exports=require("fs/promises")},1415:e=>{e.exports=require("node:events")},7561:e=>{e.exports=require("node:fs")},3977:e=>{e.exports=require("node:fs/promises")},9411:e=>{e.exports=require("node:path")},4492:e=>{e.exports=require("node:stream")},6915:e=>{e.exports=require("node:string_decoder")},1041:e=>{e.exports=require("node:url")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},3763:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>j,originalPathname:()=>y,patchFetch:()=>S,requestAsyncStorage:()=>w,routeModule:()=>x,serverHooks:()=>g,staticGenerationAsyncStorage:()=>q,staticGenerationBailout:()=>v});var o={};t.r(o),t.d(o,{POST:()=>f});var i=t(5419),a=t(9108),n=t(9678),s=t(8070),p=t(3292),u=t(1017),l=t(6113),d=t(9860),c=t.n(d);async function f(e){try{let{sku:r,includeOriginals:o=!1}=await e.json();if(!r)return s.Z.json({error:"SKU is required"},{status:400});let i=(0,u.join)(process.cwd(),"temp",r);try{await (0,p.readdir)(i)}catch{return s.Z.json({error:"No files found for this SKU"},{status:404})}let a={sku:r,createdAt:new Date().toISOString(),files:[]},n=[],d=(0,u.join)(i),c=await (0,p.readdir)(d),f=[];try{let e=(0,u.join)(process.cwd(),"temp",r,"process-info.json"),t=await (0,p.readFile)(e,"utf-8");f=JSON.parse(t)}catch{f=[]}for(let e of c){let r=(0,u.join)(d,e);await Promise.resolve().then(t.t.bind(t,7147,23)).then(e=>e.promises.stat(r));let o=/\.(jpg|jpeg|png)$/i.test(e),i=/\.(mp4|mov)$/i.test(e);if(o||i){let t=o?"image":"video",i=o?"done":"skipped",s=f.find(r=>r.finalName===e),p=s?s.originalName:e;a.files.push({original:p,final:e,type:t,status:i}),n.push({path:r,name:e})}}if(o){let e=(0,u.join)(process.cwd(),"temp",r,"originals");try{for(let r of(await (0,p.readdir)(e))){let t=(0,u.join)(e,r);n.push({path:t,name:`originals/${r}`})}}catch{}}let x=await h(n,a),w=new Date().toISOString().replace(/[:.]/g,"-"),q=(0,l.createHash)("md5").update(r+w).digest("hex").substring(0,8),g=`photo-sku-${r}-${w}-${q}.zip`;try{await m(i)}catch(e){console.warn("Failed to cleanup temp files:",e)}return new s.Z(x.buffer,{headers:{"Content-Type":"application/zip","Content-Disposition":`attachment; filename="${g}"`,"Content-Length":x.length.toString()}})}catch(e){return console.error("Download error:",e),s.Z.json({error:"Internal server error"},{status:500})}}async function h(e,r){return new Promise((t,o)=>{let i=[],a=c()("zip",{zlib:{level:6}});for(let n of(a.on("data",e=>i.push(e)),a.on("error",o),a.on("end",()=>t(Buffer.concat(i))),a.append(JSON.stringify(r,null,2),{name:"manifest.json"}),e))a.file(n.path,{name:n.name});a.finalize()})}async function m(e){let{readdir:r,unlink:o,rmdir:i}=await Promise.resolve().then(t.t.bind(t,3292,23));try{for(let t of(await r(e))){let r=(0,u.join)(e,t);await o(r)}await i(e)}catch(r){console.warn("Failed to cleanup directory:",e,r)}}let x=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/download/route",pathname:"/api/download",filename:"route",bundlePath:"app/api/download/route"},resolvedPagePath:"/Users/mak/Desktop/PhotoSku/src/app/api/download/route.ts",nextConfigOutput:"export",userland:o}),{requestAsyncStorage:w,staticGenerationAsyncStorage:q,serverHooks:g,headerHooks:j,staticGenerationBailout:v}=x,y="/api/download/route";function S(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:q})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[638,206,860],()=>t(3763));module.exports=o})();