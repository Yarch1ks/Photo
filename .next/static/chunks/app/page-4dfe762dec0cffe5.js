(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9328:function(e,s,t){Promise.resolve().then(t.bind(t,7471))},7471:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return R}});var r=t(7437),a=t(2265),l=t(3008),n=t(1981),i=t(9131),c=t(4035),d=t(8799),o=t(2549),x=t(3134),m=t(4380),h=t(5566);let g=x.Z_().min(6,"SKU должен содержать ровно 6 цифр").max(6,"SKU должен содержать ровно 6 цифр").regex(/^\d{6}$/,"SKU должен содержать только цифры (ровно 6 символов)");function u(e){try{return g.parse(e),{isValid:!0}}catch(e){if(e instanceof m.jm){var s;return{isValid:!1,error:(null===(s=e.errors[0])||void 0===s?void 0:s.message)||"Некорректный формат SKU"}}return{isValid:!1,error:"Произошла ошибка при валидации SKU"}}}function p(e,s,t){let r=s.toString().padStart(3,"0");return"".concat(e,"_").concat(r,".").concat(t)}function f(e){if(0===e)return"0 Bytes";let s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]}function j(e){return"image/heic"===e.type||e.name.toLowerCase().endsWith(".heic")}function b(e){let{onDetected:s,onError:t,isOpen:l,onClose:n}=e,[i,x]=(0,a.useState)(!1),[m,h]=(0,a.useState)(null),g=(0,a.useRef)(null),u=(0,a.useRef)(null),p=(0,a.useRef)(null),f=(0,a.useRef)(null);(0,a.useEffect)(()=>(l?j():b(),()=>{b()}),[l]);let j=async()=>{try{h(null),x(!0);let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});p.current=e,g.current&&(g.current.srcObject=e,await g.current.play()),"BarcodeDetector"in window?N():y()}catch(e){console.error("Ошибка доступа к камере:",e),h("Не удалось доступиться к камере. Пожалуйста, проверьте разрешения."),x(!1),t("Не удалось доступиться к камере")}},b=()=>{x(!1),f.current&&(cancelAnimationFrame(f.current),f.current=null),p.current&&(p.current.getTracks().forEach(e=>e.stop()),p.current=null),g.current&&(g.current.srcObject=null)},N=async()=>{if(g.current&&u.current)try{let e=new window.BarcodeDetector({formats:["code_128"]}),t=async()=>{if(i){try{let t=await e.detect(g.current);if(t.length>0){let e=t[0].rawValue;s(e),b();return}}catch(e){console.error("Ошибка детекции штрих-кода:",e)}f.current=requestAnimationFrame(t)}};t()}catch(e){console.error("Ошибка BarcodeDetector:",e),y()}},y=()=>{console.log("Используется fallback метод сканирования");let e=()=>{if(i){if(.01>Math.random()){s("MOCK1234567890"),b();return}f.current=requestAnimationFrame(e)}};e()},v=()=>{n()};return l?(0,r.jsx)("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full mx-4",children:[(0,r.jsxs)("div",{className:"p-4 border-b flex items-center justify-between",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,r.jsx)(d.Z,{className:"w-5 h-5"}),"Сканер штрих-кодов"]}),(0,r.jsx)("button",{onClick:v,className:"p-1 hover:bg-gray-100 rounded-full",children:(0,r.jsx)(o.Z,{className:"w-5 h-5"})})]}),(0,r.jsx)("div",{className:"p-4",children:m?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("div",{className:"text-red-500 mb-4",children:(0,r.jsx)(c.Z,{className:"w-12 h-12 mx-auto"})}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:m}),(0,r.jsx)("button",{onClick:v,className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700",children:"Закрыть"})]}):(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("div",{className:"aspect-video bg-gray-900 rounded-lg overflow-hidden relative",children:[(0,r.jsx)("video",{ref:g,className:"w-full h-full object-cover",playsInline:!0,muted:!0}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsx)("div",{className:"w-48 h-32 border-2 border-white border-dashed rounded-lg flex items-center justify-center",children:(0,r.jsx)("div",{className:"w-full h-full border-2 border-white border-opacity-50 rounded-lg"})})}),(0,r.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-2 h-2 bg-red-500 rounded-full"})]}),(0,r.jsx)("canvas",{ref:u,className:"hidden"}),(0,r.jsxs)("div",{className:"mt-4 text-center",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Наведите штрих-код в рамку для сканирования"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Поддерживается формат Code 128"})]})]})}),(0,r.jsx)("div",{className:"p-4 border-t flex justify-center",children:(0,r.jsxs)("button",{onClick:v,className:"bg-gray-600 text-white px-6 py-2 rounded-md hover:bg-gray-700 flex items-center gap-2",children:[(0,r.jsx)(o.Z,{className:"w-4 h-4"}),"Закрыть"]})})]})}):null}function N(e){let{onSKUSubmit:s,onError:t}=e,[d,o]=(0,a.useState)(""),[x,m]=(0,a.useState)({value:"",isValid:!1}),[h,g]=(0,a.useState)(!1),[p,f]=(0,a.useState)(!1),j=e=>{if(o(e),""===e.trim()){m({value:"",isValid:!1});return}let s=u(e);m({value:e,isValid:s.isValid,error:s.error})},N=async()=>{if(!x.isValid||!d.trim()){t("Пожалуйста, введите корректный SKU");return}f(!0);try{await s(d.trim().toUpperCase())}catch(e){t("Произошла ошибка при обработке SKU")}finally{f(!1)}};return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-md w-full mx-auto",children:[(0,r.jsxs)("div",{className:"text-center mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"CleanShot Pro"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Профессиональная обработка фотографий товаров"})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"sku-input",className:"block text-sm font-medium text-gray-700 mb-2",children:"SKU или штрих-код"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{id:"sku-input",type:"text",value:d,onChange:e=>j(e.target.value),onKeyPress:e=>{"Enter"===e.key&&x.isValid&&N()},placeholder:"123456",className:"w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 transition-colors ".concat(x.isValid?"border-green-500 focus:border-green-500 focus:ring-green-200":x.error?"border-red-500 focus:border-red-500 focus:ring-red-200":"border-gray-300 focus:border-blue-500 focus:ring-blue-200"),disabled:p}),(0,r.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:x.isValid?(0,r.jsx)(l.Z,{className:"w-5 h-5 text-green-500"}):x.error?(0,r.jsx)(n.Z,{className:"w-5 h-5 text-red-500"}):(0,r.jsx)(i.Z,{className:"w-5 h-5 text-gray-400"})})]}),x.error&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:x.error}),(0,r.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:"Строго 6 цифр"})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("button",{onClick:()=>g(!0),disabled:p,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:bg-blue-400 transition-colors flex items-center justify-center gap-2",children:[(0,r.jsx)(c.Z,{className:"w-5 h-5"}),p?"Сканирование...":"Сканировать штрих-код"]}),(0,r.jsxs)("button",{onClick:()=>{if(d.trim()){let e=u(d);e.isValid?N():t(e.error||"Некорректный формат SKU")}},disabled:!x.isValid||p,className:"w-full bg-gray-600 text-white py-3 px-4 rounded-lg hover:bg-gray-700 disabled:bg-gray-400 transition-colors flex items-center justify-center gap-2",children:[(0,r.jsx)(i.Z,{className:"w-5 h-5"}),p?"Обработка...":"Ручной ввод"]})]}),(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("div",{className:"text-blue-600 mt-0.5",children:(0,r.jsx)(i.Z,{className:"w-4 h-4"})}),(0,r.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,r.jsx)("p",{className:"font-medium mb-1",children:"Инструкция"}),(0,r.jsxs)("ul",{className:"space-y-1 text-xs",children:[(0,r.jsx)("li",{children:"• Введите 6-значный артикул товара"}),(0,r.jsx)("li",{children:"• Используйте только цифры (0-9)"}),(0,r.jsx)("li",{children:"• Пример: 123456"})]})]})]})})]}),(0,r.jsx)(b,{isOpen:h,onClose:()=>g(!1),onDetected:e=>{o(e);let s=u(e);m({value:e,isValid:s.isValid,error:s.error}),g(!1)},onError:e=>t(e)})]})}var y=t(8438),v=t(8339),w=t(3067),k=t(1138),S=t(8291),Z=t(1541),C=t(8445);function E(e){let{onFilesChange:s,acceptedTypes:t=["image/jpeg","image/png","image/heic","video/mp4","video/quicktime"],maxSize:l=26214400,multiple:i=!0}=e,[c,d]=(0,a.useState)(!1),[x,m]=(0,a.useState)([]),g=(0,a.useRef)(null),u=()=>Math.random().toString(36).substr(2,9),p=async e=>{let s=u(),t=e.type.startsWith("image/");e.type.startsWith("video/");let r={id:s,file:e,name:e.name,size:e.size,type:t?"image":"video",status:"pending"};if(t)try{let s=await b(e);r.preview=s}catch(e){console.error("Error creating preview:",e)}return r},b=e=>new Promise((s,t)=>{let r=new FileReader;r.onload=e=>{var t;return s(null===(t=e.target)||void 0===t?void 0:t.result)},r.onerror=t,r.readAsDataURL(e)}),N=async e=>{let t=Array.from(e),r=[],a=[];for(let e of t){let s=function(e){var s,t;let r=parseInt(h.env.NEXT_PUBLIC_MAX_FILE_SIZE||"26214400");if(e.size>r)return{isValid:!1,error:"Файл слишком большой. Максимальный размер: ".concat(Math.round(r/1024/1024),"MB")};let a=(null===(s=h.env.NEXT_PUBLIC_ALLOWED_IMAGE_TYPES)||void 0===s?void 0:s.split(","))||["image/jpeg","image/png","image/heic"],l=(null===(t=h.env.NEXT_PUBLIC_ALLOWED_VIDEO_TYPES)||void 0===t?void 0:t.split(","))||["video/mp4","video/quicktime"];if(![...a,...l].includes(e.type)){let e=a.join(", "),s=l.join(", ");return{isValid:!1,error:"Неподдерживаемый формат. Допустимые изображения: ".concat(e,", видео: ").concat(s)}}return{isValid:!0}}(e);if(!s.isValid){a.push("".concat(e.name,": ").concat(s.error));continue}try{let s=await p(e);r.push(s)}catch(s){a.push("".concat(e.name,": Ошибка обработки файла"))}}a.length>0&&console.warn("File validation errors:",a);let l=i?[...x,...r]:r;m(l),s(l)},w=(0,a.useCallback)(e=>{e.preventDefault(),d(!1);let s=e.dataTransfer.files;s.length>0&&N(s)},[x,i]),k=(0,a.useCallback)(e=>{e.preventDefault(),d(!0)},[]),S=(0,a.useCallback)(e=>{e.preventDefault(),d(!1)},[]),E=e=>{let t=x.filter(s=>s.id!==e);m(t),s(t)};return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer ".concat(c?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"),onDrop:w,onDragOver:k,onDragLeave:S,onClick:()=>{var e;null===(e=g.current)||void 0===e||e.click()},children:[(0,r.jsx)("input",{ref:g,type:"file",multiple:i,accept:t.join(","),onChange:e=>{let s=e.target.files;s&&s.length>0&&N(s)},className:"hidden"}),(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-3",children:[(0,r.jsx)(Z.Z,{className:"w-12 h-12 text-gray-400"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-lg font-medium text-gray-900",children:"Перетащите файлы сюда"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"или нажмите для выбора"})]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2 justify-center",children:t.map(e=>(0,r.jsx)("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:e},e))}),(0,r.jsxs)("p",{className:"text-xs text-gray-400",children:["Максимальный размер: ",f(l)]})]})]}),x.length>0&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("h3",{className:"text-sm font-medium text-gray-700",children:["Загруженные файлы (",x.length,")"]}),(0,r.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:x.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:"image"===e.type?(0,r.jsx)("div",{className:"w-12 h-12 bg-gray-200 rounded overflow-hidden",children:e.preview?(0,r.jsx)("img",{src:e.preview,alt:e.name,className:"w-full h-full object-cover"}):(0,r.jsx)(y.Z,{className:"w-full h-full text-gray-400"})}):(0,r.jsx)("div",{className:"w-12 h-12 bg-gray-200 rounded flex items-center justify-center",children:(0,r.jsx)(v.Z,{className:"w-6 h-6 text-gray-400"})})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[(0,r.jsx)("span",{children:f(e.size)}),(0,r.jsx)("span",{children:"•"}),(0,r.jsx)("span",{className:"flex items-center gap-1",children:"image"===e.type?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C.Z,{className:"w-3 h-3"}),"Изображение"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(v.Z,{className:"w-3 h-3"}),"Видео"]})}),j(e.file)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:"•"}),(0,r.jsxs)("span",{className:"text-orange-600 flex items-center gap-1",children:[(0,r.jsx)(n.Z,{className:"w-3 h-3"}),"Требуется конвертация"]})]})]})]}),(0,r.jsx)("button",{onClick:()=>E(e.id),className:"flex-shrink-0 p-1 text-gray-400 hover:text-red-500 transition-colors",children:(0,r.jsx)(o.Z,{className:"w-4 h-4"})})]},e.id))})]})]})}function P(e){let{sku:s,onBack:i,onContinue:c,onError:d}=e,[o,x]=(0,a.useState)([]),[m,h]=(0,a.useState)(!1),[g,u]=(0,a.useState)(0),f=(0,a.useCallback)(e=>{x(e)},[]),b=async()=>{let e=o.filter(e=>j(e.file));if(0===e.length){c(o);return}h(!0),u(0);try{let s=[],t=e.length;for(let r=0;r<e.length;r++){let a=e[r];u(Math.round((r+1)/t*100));try{let e=await N(a);s.push(e)}catch(e){console.error("Error converting HEIC file:",e),d("Не удалось конвертировать файл: ".concat(a.name))}}let r=o.filter(e=>!j(e.file)).concat(s);x(r),c(r)}catch(e){d("Произошла ошибка при конвертации файлов")}finally{h(!1),u(0)}},N=async e=>{let r=(await t.e(156).then(t.t.bind(t,7191,23))).default,a=await r({blob:e.file,quality:.92,toType:"image/jpeg"}),l=p(s,o.findIndex(s=>s.id===e.id)+1,"jpg"),n=new File([a],l,{type:"image/jpeg"}),i=await Z(n);return{...e,file:n,name:n.name,converted:!0,preview:i,status:"ready"}},Z=e=>new Promise((s,t)=>{let r=new FileReader;r.onload=e=>{var t;return s(null===(t=e.target)||void 0===t?void 0:t.result)},r.onerror=t,r.readAsDataURL(e)}),C=async()=>{if(0===o.length){d("Пожалуйста, загрузите хотя бы один файл");return}o.some(e=>j(e.file))?await b():c(o)},P=()=>o.filter(e=>"image"===e.type),F=()=>o.filter(e=>"video"===e.type);return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-4xl w-full mx-auto",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Загрузка медиа файлов"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,r.jsx)("span",{children:"SKU:"}),(0,r.jsx)("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:s})]})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(E,{onFilesChange:f,acceptedTypes:["image/jpeg","image/png","image/heic","video/mp4","video/quicktime"],maxSize:26214400,multiple:!0}),o.length>0&&(0,r.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(y.Z,{className:"w-4 h-4 text-blue-500"}),(0,r.jsxs)("span",{children:["Изображения: ",P().length,P().some(e=>j(e.file))&&(0,r.jsx)("span",{className:"text-orange-600 ml-1",children:"(HEIC требует конвертации)"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(v.Z,{className:"w-4 h-4 text-green-500"}),(0,r.jsxs)("span",{children:["Видео: ",F().length]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(l.Z,{className:"w-4 h-4 text-gray-500"}),(0,r.jsxs)("span",{children:["Всего: ",o.length," файлов"]})]})]})}),m&&(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full"}),(0,r.jsx)("span",{className:"text-sm font-medium text-blue-800",children:"Конвертация HEIC файлов в JPG..."})]}),(0,r.jsx)("div",{className:"w-full bg-blue-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(g,"%")}})}),(0,r.jsxs)("p",{className:"text-xs text-blue-600 mt-1",children:[g,"% завершено"]})]}),F().length>0&&(0,r.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)(n.Z,{className:"w-4 h-4 text-yellow-600 mt-0.5"}),(0,r.jsxs)("div",{className:"text-sm text-yellow-800",children:[(0,r.jsx)("p",{className:"font-medium mb-1",children:"Важно"}),(0,r.jsx)("p",{children:"Видео файлы не будут обработаны в Photoroom. Они будут включены в финальный архив без изменений."})]})]})}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 pt-4 border-t",children:[(0,r.jsxs)("button",{onClick:i,className:"flex-1 bg-gray-600 text-white py-3 px-4 rounded-lg hover:bg-gray-700 transition-colors flex items-center justify-center gap-2",children:[(0,r.jsx)(w.Z,{className:"w-4 h-4"}),"Назад"]}),(0,r.jsxs)("button",{onClick:()=>{x([])},disabled:0===o.length||m,className:"flex-1 bg-red-600 text-white py-3 px-4 rounded-lg hover:bg-red-700 disabled:bg-red-400 transition-colors flex items-center justify-center gap-2",children:[(0,r.jsx)(k.Z,{className:"w-4 h-4"}),"Очистить"]}),(0,r.jsxs)("button",{onClick:C,disabled:0===o.length||m,className:"flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:bg-blue-400 transition-colors flex items-center justify-center gap-2",children:[(0,r.jsx)(S.Z,{className:"w-4 h-4"}),m?"Конвертация...":"Продолжить"]})]})]})]})}var F=t(6264),U=t(4280),T=t(6020),O=t(6141);function I(e){let{files:s,title:t="Обработка файлов",subtitle:i="Пожалуйста, дождитесь завершения обработки",onComplete:c}=e,[d,o]=(0,a.useState)(0),[x,m]=(0,a.useState)(0);(0,a.useEffect)(()=>{let e=s.filter(e=>"done"===e.status||"skipped"===e.status).length;o(e);let t=s.filter(e=>"processing"===e.status),r=t.reduce((e,s)=>e+(s.progress||0),0),a=t.length>0?r/t.length:0;m(Math.round(e/s.length*100+a*t.length/s.length)),e===s.length&&s.length>0&&(null==c||c())},[s,c]);let h=(e,s)=>{switch(e){case"queued":return(0,r.jsx)(O.Z,{className:"w-4 h-4 text-gray-400"});case"processing":return(0,r.jsx)(F.Z,{className:"w-4 h-4 text-blue-500 animate-spin"});case"done":return(0,r.jsx)(l.Z,{className:"w-4 h-4 text-green-500"});case"error":return(0,r.jsx)(n.Z,{className:"w-4 h-4 text-red-500"});case"skipped":return(0,r.jsx)(v.Z,{className:"w-4 h-4 text-yellow-500"})}},g=e=>{switch(e){case"queued":return"В очереди";case"processing":return"Обработка...";case"done":return"Готово";case"error":return"Ошибка";case"skipped":return"Пропущено"}},u=e=>{switch(e){case"queued":return"text-gray-500";case"processing":return"text-blue-600";case"done":return"text-green-600";case"error":return"text-red-600";case"skipped":return"text-yellow-600"}},p=e=>{switch(e){case"queued":return"bg-gray-200";case"processing":return"bg-blue-500";case"done":return"bg-green-500";case"error":return"bg-red-500";case"skipped":return"bg-yellow-500"}},f=s.filter(e=>"image"===e.type),j=s.filter(e=>"video"===e.type),b=f.filter(e=>"done"===e.status).length,N=j.filter(e=>"skipped"===e.status).length;return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-4xl w-full mx-auto",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:t}),(0,r.jsx)("p",{className:"text-gray-600",children:i})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Общий прогресс"}),(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:[x,"%"]})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,r.jsx)("div",{className:"bg-blue-600 h-3 rounded-full transition-all duration-500",style:{width:"".concat(x,"%")}})}),(0,r.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 mt-2",children:[(0,r.jsxs)("span",{children:["Обработано: ",d,"/",s.length]}),(0,r.jsxs)("span",{children:["Изображения: ",b,", Видео: ",N]})]})]}),(0,r.jsx)("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:s.map(e=>(0,r.jsxs)("div",{className:"border rounded-lg p-4 bg-gray-50",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:"image"===e.type?(0,r.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded flex items-center justify-center",children:(0,r.jsx)(C.Z,{className:"w-5 h-5 text-blue-600"})}):(0,r.jsx)("div",{className:"w-10 h-10 bg-yellow-100 rounded flex items-center justify-center",children:(0,r.jsx)(v.Z,{className:"w-5 h-5 text-yellow-600"})})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.originalName}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"→"}),(0,r.jsx)("p",{className:"text-sm text-green-600 font-medium truncate",children:e.finalName.replace(/\.(\w+)\.\w+$/,".$1")})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[h(e.status,e.type),(0,r.jsx)("span",{className:"text-sm ".concat(u(e.status)),children:g(e.status)}),e.error&&(0,r.jsxs)("span",{className:"text-xs text-red-500",children:["(",e.error,")"]})]})]}),(0,r.jsx)("div",{className:"flex-shrink-0 w-24",children:"processing"===e.status&&void 0!==e.progress&&(0,r.jsx)("div",{className:"text-right",children:(0,r.jsxs)("div",{className:"text-xs text-blue-600 font-medium",children:[e.progress,"%"]})})})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 ".concat(p(e.status)),style:{width:"processing"===e.status&&void 0!==e.progress?"".concat(e.progress,"%"):"done"===e.status||"skipped"===e.status?"100%":"0%"}})})]},e.id))}),(0,r.jsx)("div",{className:"mt-6 pt-4 border-t border-gray-200",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:f.filter(e=>"done"===e.status).length}),(0,r.jsx)("div",{className:"text-gray-500",children:"Изображений обработано"})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:j.filter(e=>"skipped"===e.status).length}),(0,r.jsx)("div",{className:"text-gray-500",children:"Видео пропущено"})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-red-600",children:s.filter(e=>"error"===e.status).length}),(0,r.jsx)("div",{className:"text-gray-500",children:"Ошибок"})]})]})})]})}function D(e){let{sku:s,files:t,onBack:i,onComplete:c,onError:d}=e,[o,x]=(0,a.useState)([]),[m,h]=(0,a.useState)(!1),[g,u]=(0,a.useState)(null),[f,j]=(0,a.useState)(!1);(0,a.useEffect)(()=>{b()},[t,s]);let b=()=>{console.log("Initializing progress with files:",t);let e=t.map((e,t)=>{let r=p(s,t+1,e.file.name.split(".").pop()||"jpg");return{id:e.id,name:e.name,type:e.type,status:"video"===e.type?"skipped":"queued",originalName:e.name,finalName:r,progress:0}});console.log("Initialized progress files:",e),x(e)},N=async()=>{h(!0),u(new Date);try{let e=new FormData;e.append("sku",s),t.forEach(s=>{e.append("files",s.file)}),console.log("Uploading files:",t.map(e=>e.name)),console.log("FormData entries:",Array.from(e.entries()).map(e=>{let[s,t]=e;return[s,t instanceof File?t.name:t]}));let r=await fetch("/api/upload",{method:"POST",body:e});if(!r.ok){let e=await r.json().catch(()=>({}));throw console.error("Upload error response:",e),Error(e.error||"Failed to upload files")}let a=await r.json();console.log("Upload result:",a);let l={sku:s,files:a.files.map(e=>({id:e.id,fileName:e.fileName,filePath:e.filePath,type:e.type,originalName:e.originalName}))},n=o.map((e,s)=>{let t=a.files[s];return t?{...e,id:t.id,originalName:t.originalName}:e});x(n),console.log("Process payload:",l);let i=await fetch("/api/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!i.ok){let e=await i.json().catch(()=>({}));throw console.error("Process error response:",e),Error(e.error||"Failed to process files")}let c=await i.json();console.log("Process result:",c),console.log("Process result results:",c.results),console.log("Progress files before update:",o.map(e=>({id:e.id,name:e.name})));let d=o.map(e=>{console.log("Looking for processed file for: ".concat(e.name," (original: ").concat(e.originalName,")"));let s=c.results.find(s=>{let t=a.files.find(e=>e.originalName===s.originalName);if(t){let r=t.originalName===e.name||t.fileName===e.name;return console.log("Comparing ".concat(s.originalName," with ").concat(e.name,": name match: ").concat(r)),r}return!1});return s?(console.log("Found processed file:",s),{...e,status:s.status,finalName:s.finalName,error:s.error,processedPath:s.processedPath}):(console.log("Processed file not found for: ".concat(e.name)),e)});console.log("Updated files:",d),console.log("Updated files details:",d.map(e=>({id:e.id,name:e.name,status:e.status,finalName:e.finalName,originalName:e.originalName}))),x(d)}catch(e){console.error("Processing error:",e),d(e instanceof Error?e.message:"Произошла ошибка при обработке файлов")}finally{h(!1)}},y=()=>{c(o)},v=async()=>{x(o.map(e=>"error"===e.status?{...e,status:"queued",error:void 0}:e)),await N()},k=async()=>{j(!0);try{let e=await fetch("/api/telegram",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sku:s,chatId:"-4914435522"})});if(!e.ok){let s=await e.json().catch(()=>({}));throw Error(s.error||"Failed to send files to Telegram")}let t=await e.json();console.log("Files sent to Telegram:",t),alert("Файлы успешно отправлены в Telegram!")}catch(e){console.error("Telegram send error:",e),alert("Ошибка при отправке в Telegram: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{j(!1)}},Z=(()=>{let e=o.length,s=o.filter(e=>"image"===e.type).length,t=o.filter(e=>"video"===e.type).length;return{total:e,images:s,videos:t,done:o.filter(e=>"done"===e.status).length,errors:o.filter(e=>"error"===e.status).length,processing:o.filter(e=>"processing"===e.status).length}})(),C=Z.errors>0,E=Z.done+Z.errors===Z.total;return(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsxs)("header",{className:"text-center mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Photo SKU Processor"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Обработка фотографий товаров с привязкой к штрих-коду"})]}),(0,r.jsxs)("main",{className:"max-w-4xl mx-auto",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Обработка файлов"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["SKU: ",s]})]}),m&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[(0,r.jsx)(F.Z,{className:"w-4 h-4 animate-spin"}),(0,r.jsx)("span",{children:"Обработка..."})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"bg-blue-50 rounded-lg p-3 text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:Z.images}),(0,r.jsx)("div",{className:"text-xs text-gray-600",children:"Изображений"})]}),(0,r.jsxs)("div",{className:"bg-yellow-50 rounded-lg p-3 text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:Z.videos}),(0,r.jsx)("div",{className:"text-xs text-gray-600",children:"Видео"})]}),(0,r.jsxs)("div",{className:"bg-green-50 rounded-lg p-3 text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-green-600",children:Z.done}),(0,r.jsx)("div",{className:"text-xs text-gray-600",children:"Готово"})]}),(0,r.jsxs)("div",{className:"bg-red-50 rounded-lg p-3 text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-red-600",children:Z.errors}),(0,r.jsx)("div",{className:"text-xs text-gray-600",children:"Ошибок"})]})]}),Z.videos>0&&(0,r.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)(n.Z,{className:"w-4 h-4 text-yellow-600 mt-0.5"}),(0,r.jsxs)("div",{className:"text-sm text-yellow-800",children:[(0,r.jsx)("p",{className:"font-medium mb-1",children:"Важно"}),(0,r.jsx)("p",{children:"Видео файлы не будут обработаны в Photoroom. Они будут включены в финальный архив без изменений."})]})]})}),!m&&0===Z.done&&(0,r.jsxs)("div",{className:"text-center mb-6",children:[(0,r.jsxs)("button",{onClick:()=>{console.log("Start processing clicked, files:",t),console.log("Progress files before start:",o),N()},disabled:0===t.length,className:"bg-blue-600 text-white py-3 px-8 rounded-lg hover:bg-blue-700 disabled:bg-blue-400 transition-colors flex items-center gap-2 mx-auto",children:[(0,r.jsx)(U.Z,{className:"w-4 h-4"}),"Начать обработку"]}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Максимально 3 файла обрабатываются одновременно"})]}),C&&!m&&(0,r.jsx)("div",{className:"text-center mb-6",children:(0,r.jsxs)("button",{onClick:v,className:"bg-orange-600 text-white py-2 px-6 rounded-lg hover:bg-orange-700 transition-colors flex items-center gap-2 mx-auto",children:[(0,r.jsx)(U.Z,{className:"w-4 h-4"}),"Повторить обработку ошибочных файлов"]})}),E&&!m&&(0,r.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(l.Z,{className:"w-5 h-5 text-green-600"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-green-800",children:"Обработка завершена!"}),(0,r.jsxs)("p",{className:"text-sm text-green-600",children:[Z.done," файлов успешно обработано"]})]})]})})]}),(0,r.jsx)(I,{files:o,title:"Прогресс обработки",subtitle:"Следите за статусом каждого файла",onComplete:y}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 mt-6",children:[(0,r.jsxs)("button",{onClick:i,className:"flex-1 bg-gray-600 text-white py-3 px-4 rounded-lg hover:bg-gray-700 transition-colors flex items-center justify-center gap-2",children:[(0,r.jsx)(w.Z,{className:"w-4 h-4"}),"Назад"]}),E&&!m&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:k,disabled:f,className:"flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:bg-blue-400 transition-colors flex items-center justify-center gap-2",children:f?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(F.Z,{className:"w-4 h-4 animate-spin"}),"Отправка..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(T.Z,{className:"w-4 h-4"}),"Отправить в Telegram"]})}),(0,r.jsxs)("button",{onClick:y,className:"flex-1 bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2",children:[(0,r.jsx)(S.Z,{className:"w-4 h-4"}),"Показать результаты"]})]})]})]})]})})}var L=t(5817);let _=e=>{let s=e.lastIndexOf(".");if(s>0){let t=e.substring(0,s),r=e.substring(s),a=t.lastIndexOf(".");if(a>0)return t.substring(a+1)+r}return e};function V(e){let{sku:s,files:t,onBack:i,onRestart:c,onError:d}=e,[o,x]=(0,a.useState)(!1),[m,h]=(0,a.useState)(0),[g,u]=(0,a.useState)(null),[p,f]=(0,a.useState)(!1),j=t.filter(e=>"done"===e.status),b=t.filter(e=>"skipped"===e.status),N=t.filter(e=>"error"===e.status),y=async()=>{if(0===j.length){d("Нет готовых файлов для скачивания");return}x(!0),h(0);try{let e=await fetch("/api/download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sku:s,includeOriginals:!1})});if(!e.ok)throw Error("Failed to download ZIP file");let t=await e.blob(),r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download="photo-sku-".concat(s,"-").concat(new Date().toISOString().replace(/[:.]/g,"-"),".zip"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)}catch(e){console.error("Download error:",e),d("Произошла ошибка при скачивании ZIP файла")}finally{x(!1),h(0)}},k=async()=>{if(0===t.length){d("Нет файлов для скачивания");return}x(!0),h(0);try{let e=await fetch("/api/download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sku:s,includeOriginals:!0})});if(!e.ok)throw Error("Failed to download ZIP file");let t=await e.blob(),r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download="photo-sku-".concat(s,"-").concat(new Date().toISOString().replace(/[:.]/g,"-"),"-with-originals.zip"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)}catch(e){console.error("Download error:",e),d("Произошла ошибка при скачивании ZIP файла")}finally{x(!1),h(0)}},S=async()=>{f(!0);try{let e=await fetch("/api/telegram",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sku:s,chatId:"-4914435522"})});if(!e.ok){let s=await e.json().catch(()=>({}));throw Error(s.error||"Failed to send files to Telegram")}let t=await e.json();console.log("Files sent to Telegram:",t),alert("Файлы успешно отправлены в Telegram!")}catch(e){console.error("Telegram send error:",e),alert("Ошибка при отправке в Telegram: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{f(!1)}},Z=e=>"image"===e.type&&"done"===e.status&&e.finalName?"/api/images/".concat(s,"/").concat(e.finalName):"image"===e.type?"/placeholder-image.jpg":"/placeholder-video.jpg";return(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,r.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("main",{className:"max-w-4xl mx-auto",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[(0,r.jsxs)("div",{className:"text-center mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Обработка завершена!"}),(0,r.jsxs)("p",{className:"text-gray-600",children:["SKU: ",s]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:[(0,r.jsx)("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:j.length}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Изображений обработано"})]}),(0,r.jsxs)("div",{className:"bg-yellow-50 rounded-lg p-4 text-center",children:[(0,r.jsx)("div",{className:"text-3xl font-bold text-yellow-600 mb-2",children:b.length}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Видео пропущено"})]}),(0,r.jsxs)("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[(0,r.jsx)("div",{className:"text-3xl font-bold text-green-600 mb-2",children:t.length}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Всего файлов"})]}),(0,r.jsxs)("div",{className:"bg-red-50 rounded-lg p-4 text-center",children:[(0,r.jsx)("div",{className:"text-3xl font-bold text-red-600 mb-2",children:N.length}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Ошибок"})]})]}),N.length>0&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)(n.Z,{className:"w-4 h-4 text-red-600 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-red-800 mb-1",children:"Обнаружены ошибки при обработке"}),(0,r.jsx)("p",{className:"text-sm text-red-600",children:"Некоторые файлы не удалось обработать. Попробуйте загрузить их снова."})]})]})}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("button",{onClick:y,disabled:o||0===j.length,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:bg-blue-400 transition-colors flex items-center justify-center gap-2",children:o?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}),(0,r.jsx)("span",{children:"Создание архива..."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(L.Z,{className:"w-4 h-4"}),"Скачать ZIP (только обработанные изображения)"]})}),(0,r.jsx)("button",{onClick:k,disabled:o||0===t.length,className:"w-full bg-gray-600 text-white py-3 px-4 rounded-lg hover:bg-gray-700 disabled:bg-gray-400 transition-colors flex items-center justify-center gap-2",children:o?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}),(0,r.jsx)("span",{children:"Создание архива..."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(L.Z,{className:"w-4 h-4"}),"Скачать ZIP (включая оригиналы и видео)"]})})]}),o&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Создание архива"}),(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:[m,"%"]})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(m,"%")}})})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,r.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Результаты обработки"}),(0,r.jsx)("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:t.map(e=>(0,r.jsx)("div",{className:"border rounded-lg p-4 ".concat("done"===e.status?"bg-green-50 border-green-200":"skipped"===e.status?"bg-yellow-50 border-yellow-200":"error"===e.status?"bg-red-50 border-red-200":"bg-gray-50 border-gray-200"),children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:"image"===e.type?(0,r.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded flex items-center justify-center",children:(0,r.jsx)(C.Z,{className:"w-6 h-6 text-blue-600"})}):(0,r.jsx)("div",{className:"w-12 h-12 bg-yellow-100 rounded flex items-center justify-center",children:(0,r.jsx)(v.Z,{className:"w-6 h-6 text-yellow-600"})})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.originalName}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"→"}),(0,r.jsx)("p",{className:"text-sm text-green-600 font-medium truncate",children:_(e.finalName)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:["done"===e.status&&(0,r.jsx)(l.Z,{className:"w-4 h-4 text-green-500"}),"skipped"===e.status&&(0,r.jsx)(v.Z,{className:"w-4 h-4 text-yellow-500"}),"error"===e.status&&(0,r.jsx)(n.Z,{className:"w-4 h-4 text-red-500"}),(0,r.jsx)("span",{className:"text-sm ".concat("done"===e.status?"text-green-600":"skipped"===e.status?"text-yellow-600":"error"===e.status?"text-red-600":"text-gray-500"),children:"done"===e.status?"Готово":"skipped"===e.status?"Пропущено":"error"===e.status?"Ошибка":"В обработке"}),e.error&&(0,r.jsxs)("span",{className:"text-xs text-red-500",children:["(",e.error,")"]})]})]}),(0,r.jsx)("div",{className:"flex-shrink-0",children:"image"===e.type&&"done"===e.status&&(0,r.jsx)("div",{className:"w-16 h-16 bg-gray-200 rounded overflow-hidden cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>u(Z(e)),children:(0,r.jsx)("img",{src:Z(e),alt:e.finalName,className:"w-full h-full object-cover"})})})]})},e.id))})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 mt-6",children:[(0,r.jsxs)("button",{onClick:i,className:"flex-1 bg-gray-600 text-white py-3 px-4 rounded-lg hover:bg-gray-700 transition-colors flex items-center justify-center gap-2",children:[(0,r.jsx)(w.Z,{className:"w-4 h-4"}),"Назад"]}),(0,r.jsx)("button",{onClick:S,disabled:p,className:"flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:bg-blue-400 transition-colors flex items-center justify-center gap-2",children:p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(F.Z,{className:"w-4 h-4 animate-spin"}),"Отправка..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(T.Z,{className:"w-4 h-4"}),"Отправить в Telegram"]})}),(0,r.jsxs)("button",{onClick:c,className:"flex-1 bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2",children:[(0,r.jsx)(U.Z,{className:"w-4 h-4"}),"Начать заново"]})]})]})})})}function R(){let[e,s]=(0,a.useState)("sku"),[t,l]=(0,a.useState)(""),[n,i]=(0,a.useState)([]),[c,d]=(0,a.useState)([]),o=async e=>{l(e),s("media")},x=e=>{console.error("Error:",e)};return(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsx)("header",{className:"text-center mb-8",children:(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)("img",{src:"https://motozilla.com.ua/wa-data/public/site/themes/motozilla_new/img/logo2.svg",alt:"CleanShot Pro Logo",className:"h-12 w-auto"})})}),(0,r.jsxs)("main",{className:"max-w-4xl mx-auto",children:["sku"===e&&(0,r.jsx)(N,{onSKUSubmit:o,onError:x}),"media"===e&&(0,r.jsx)(P,{sku:t,onBack:()=>s("sku"),onContinue:e=>{i(e),s("processing")},onError:x}),"processing"===e&&(0,r.jsx)(D,{sku:t,files:n,onBack:()=>s("media"),onComplete:e=>{d(e),s("results")},onError:x}),"results"===e&&(0,r.jsx)(V,{sku:t,files:c,onBack:()=>s("processing"),onRestart:()=>{s("sku"),l(""),i([]),d([])},onError:x})]})]})})}}},function(e){e.O(0,[135,971,938,744],function(){return e(e.s=9328)}),_N_E=e.O()}]);